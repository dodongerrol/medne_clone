// var protocol = jQuery(location).attr('protocol');
// var hostname = jQuery(location).attr('hostname');
// var folderlocation = $(location).attr('pathname').split('/')[1];
// window.base_url = protocol+'//'+hostname+'/'+folderlocation+'/public/admin/';

////window.base_url = 'http://localhost/medicloud_web/public/admin/';
//window.base_url = 'http://medicloud.sg/medicloud_web/public/app/';

window.base_url = window.location.origin + '/admin/';

window.base_loading_image = '<img src="http://medicloud.sg/medicloud_v2/public/assets/images/ajax-loader.gif" width="32" height="32"  alt=""/>';




jQuery("document").ready(function(){
    //window.base_url = 'http://'+jQuery(location).attr('hostname')+'/medicloud_web/public/admin/';

    AdminSignINValidation();

    jQuery("#admin-login").click(function(){
        var email = jQuery("#Email").val();
        var password = jQuery("#Password").val();

        dataValues = '&email='+email+'&password='+password;

        if(jQuery("#admin-form-signin").valid() ==true){
            jQuery.blockUI({ message: '<h1> '+base_loading_image+' <br /> Please wait for a moment</h1>' });
            jQuery.ajax({
                type: "POST",
                url : base_url+"auth/loginprocess",
                data : dataValues,

                success : function(data){
                    console.log(data);
                    if(data == 1){
                        window.location = base_url+"clinic/all-clinics";
                    }else{
                        jQuery("#ajax-error").html("<div class='error-notification'>Please check admin credential</div>");
                    }
                    jQuery.unblockUI();
                }
            });
        }
    });


    // generate booking searh result csv
    jQuery("#dl_generate").click(function( e ) {

        // e.preventDefault();
        var btn_default_text = $('#dl_generate').text();
        var bookingid = jQuery('#bookingid').val();
        var startdate = jQuery('#startdate').val();
        var enddate = jQuery('#enddate').val();
        var clinic = jQuery('#clinic').val();
        var doctor = jQuery('#doctor').val();
        var created_startbooking = jQuery('#created_startdate').val();
        var created_endbooking = jQuery('#created_enddate').val();
        dataValues = 'bookingid='+bookingid+'&startdate='+startdate+'&enddate='+enddate+'&clinic='+clinic+'&doctor='+doctor+'&created_startbooking='+created_startbooking+'&created_endbooking='+created_endbooking;
        $('#dl_generate').text('Downloading...');
        $('#dl_generate').attr('disabled', true);
        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "clinic/download_booking_details",
            data: dataValues,

            success: function (data){
                if(data.success == true){
                    window.open(window.location.origin + data.path, '_blank');
                }else{
                    jQuery('#results-area').html("Sorry! no record found");
                }
                $('#dl_generate').text(btn_default_text);
                $('#dl_generate').attr('disabled', false);
                jQuery.unblockUI();
            }
        });
    });

    // generate user sign csv
    jQuery("#dl_sign_users").click(function( e ) {

        if($('#all_users').is(':checked')) {
          console.log('checked');
          var checked = true;
        } else {
          console.log('!checked');
          var checked = false;
        }
        var btn_default_text = $('#dl_sign_users').text();
        var startdate = jQuery('#startdate').val();
        var enddate = jQuery('#enddate').val();

        dataValues = 'startdate='+startdate+'&enddate='+enddate+'&all_users='+checked;
        $('#dl_sign_users').text('Downloading...');
        $('#dl_sign_users').attr('disabled', true);
        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "user/download-sign-user/",
            data: dataValues,

            success: function (data){
                if(data.success == true){
                    window.open(window.location.origin + data.path, '_blank');
                }else{
                    jQuery('#download-results-area').html("Sorry! no record found");
                }
                $('#dl_sign_users').text(btn_default_text);
                $('#dl_sign_users').attr('disabled', false);
                jQuery.unblockUI();
            }
        });
    });

    jQuery("#search-custom").hide();
    MakeNullObjects(1);

    jQuery('.search_option').click(function () {
        var searchop = jQuery(this).val();
        MakeNullObjects(searchop);
        if(searchop==1){
            jQuery("#search-custom").show();
            jQuery("#search-book-id").hide();
        }else{
            jQuery("#search-book-id").show();
            jQuery("#search-custom").hide();
        }
    });

    jQuery('.download_option').click(function () {
        var searchop = jQuery(this).val();

        if(searchop==1){
            jQuery("#download-custom").show();
            jQuery("#download-all").hide();
        }else{
            jQuery("#download-all").show();
            jQuery("#download-custom").hide();
        }
    });

    jQuery("#clinic").on('change', function () {
        var clinicid = jQuery(this).val();
        //console.log(clinic);
        dataValues = 'clinicid='+clinicid;

        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "clinic/clinic_doctor",
            data: dataValues,
            success: function (data){
                if(data !=0){
                    jQuery('#doctor').html(data);
                }else{
                    jQuery('#doctor').html("<option value=''>select</option>");
                }
                jQuery.unblockUI();
            }
        });
    });

    // for sign users
    jQuery('#search_sign_users').click(function () {
        var startdate = jQuery('#startdate').val();
        var enddate = jQuery('#enddate').val();
        dataValues = 'startdate='+startdate+'&enddate='+enddate+'&all_users=false';
        console.log(dataValues);
        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "user/search/signed-users",
            data: dataValues,

            success: function (data){
                console.log(data);
                if(data !=0){
                    jQuery('#download-results-area').html(data);
                    $('#dl_sign_users').fadeIn();
                }else{
                    jQuery('#download-results-area').html("Sorry! no record found");
                }
                jQuery.unblockUI();
            }
        });
    });

      jQuery('#all_users').click(function () {
        var startdate = jQuery('#startdate').val();
        var enddate = jQuery('#enddate').val();
        dataValues = 'startdate='+startdate+'&enddate='+enddate+'&all_users=true';
        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "user/search/signed-users",
            data: dataValues,

            success: function (data){
                if(data !=0){
                    jQuery('#download-results-area').html(data);
                    $('#dl_sign_users').fadeIn();
                }else{
                    jQuery('#download-results-area').html("Sorry! no record found");
                }
                jQuery.unblockUI();
            }
        });
      });

    Clinic_Details_Update();
});

function AdminSignINValidation(){
    var validator = jQuery("#admin-form-signin").validate({
        rules: {
            Email: {
                required: true,
                email:true
            },
            Password: {
                  required: true,
                  minlength: 5
            }
        },
        messages: {
          Email: "Please specify email",
          Password: "Please specify password"
        }
     });
}
function MakeNullObjects(id){
    if(id==1){
        jQuery('#bookingid').val('');
    }else{
        jQuery('#startdate').val('');
        jQuery('#enddate').val('');
        jQuery('#clinic').val('');
        jQuery('#doctor').val('');
        jQuery('#created_startdate').val('');
        jQuery('#created_enddate').val('');
    }
}

function Clinic_Details_Update() {
    jQuery('#search_booking').click(function () {
        var bookingid = jQuery('#bookingid').val();
        var startdate = jQuery('#startdate').val();
        var enddate = jQuery('#enddate').val();
        var clinic = jQuery('#clinic').val();
        var doctor = jQuery('#doctor').val();
        var created_startbooking = jQuery('#created_startdate').val();
        var created_endbooking = jQuery('#created_enddate').val();
        dataValues = 'bookingid='+bookingid+'&startdate='+startdate+'&enddate='+enddate+'&clinic='+clinic+'&doctor='+doctor+'&created_startbooking='+created_startbooking+'&created_endbooking='+created_endbooking;

        jQuery.blockUI({message: '<h1> ' + base_loading_image + ' <br /> Please wait for a moment</h1>'});
        jQuery.ajax({
            type: "POST",
            url: base_url + "clinic/search_booking_process",
            data: dataValues,

            success: function (data){
                if(data !=0){
                    jQuery('#results-area').html(data);
                    jQuery('#bookingid').val('');
                }else{
                    jQuery('#results-area').html("Sorry! no record found");
                }
                jQuery.unblockUI();
            }
        });
    });
}
